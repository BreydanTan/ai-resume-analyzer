# 调试决策树 | Debugging Flowchart

## 🌳 从问题到解决方案的路径

当你的代码不工作时，这个决策树会帮你一步步诊断问题。

---

## 第一层：问题分类

```
┌─────────────────────────────┐
│   我的应用出问题了！       │
└────────────┬────────────────┘
             │
    ┌────────┼────────┬──────────┬──────────┐
    │        │        │          │          │
    ▼        ▼        ▼          ▼          ▼
  无法    代码有    页面      数据无  功能表
  启动    错误      显示不     法保   现异
          (Crash)   对        存      常
```

---

## 分支1️⃣：无法启动项目

```
应用无法启动
    ↓
[检查1] 有错误信息吗？
    │
    ├─ 是 ▶ 查看 error-encyclopedia.md
    │
    └─ 否 ▶ 继续
          ↓
    [检查2] npm run dev 是否执行？
          ├─ 否 (没有反应) ▶ 尝试重新运行
          │                 ├─ 有效？ ▶ ✅ 解决！
          │                 └─ 无效？ ▶ 下一步
          │
          └─ 是 ▶ 继续
                ↓
    [检查3] 浏览器能连接吗？
          ├─ 无法连接 localhost:5173
          │ ├─ 检查防火墙
          │ ├─ 尝试不同端口: npm run dev -- --port 3000
          │ └─ 重启电脑
          │
          └─ 能连接但显示错误 ▶ 查看浏览器控制台(F12)
                               ├─ Module error? ▶ npm install
                               ├─ Script error? ▶ 看错误信息
                               └─ Blank page? ▶ 硬刷新(Ctrl+Shift+R)
```

### 快速检查清单
- [ ] npm install 运行过吗？
- [ ] package.json 文件完整吗？
- [ ] Node.js 版本正确吗？(v20+)
- [ ] 端口5173没被占用吗？

---

## 分支2️⃣：代码崩溃(Crash)

```
浏览器console看到红色错误
    ↓
[步骤1] 复制整个错误信息
    ├─ "Cannot find module" → 缺少依赖
    │ └─ npm install
    │
    ├─ "Cannot read property" → 对象是undefined
    │ └─ 添加 ? 可选链操作符
    │
    ├─ "Unexpected token" → 语法错误
    │ └─ 检查括号、引号、逗号
    │
    ├─ "puter is not defined" → Puter未加载
    │ └─ 等待页面完全加载
    │
    └─ 其他 ▶ 去 error-encyclopedia.md 查
          ↓
[步骤2] 找到出错的代码行
    ├─ Stack trace 中看到文件名
    └─ 在编辑器中打开那个文件
          ↓
[步骤3] 理解为什么出错
    ├─ 变量是undefined吗？
    ├─ 函数参数正确吗？
    ├─ 异步操作完成了吗？
    └─ 数据格式对吗？
          ↓
[步骤4] 修复
    ├─ 添加类型检查
    ├─ 添加默认值
    ├─ 添加 try-catch
    ├─ 等待异步完成
    └─ 刷新浏览器看修复是否有效
```

### 常见Crash修复

| 错误 | 修复 |
|------|------|
| Cannot read property 'x' of undefined | `obj?.x ?? defaultValue` |
| ReferenceError: x is not defined | 检查是否导入了 |
| TypeError: x is not a function | `typeof x === 'function'` |
| JSON.parse error | `try-catch` 包装 |

---

## 分支3️⃣：页面显示不对

```
应用运行，但页面看起来不对
    ↓
[检查1] 什么不对？
    │
    ├─ 空白页 ▶ [处理1]
    ├─ 显示错误信息 ▶ [处理2]
    ├─ 数据没显示 ▶ [处理3]
    ├─ 样式很丑 ▶ [处理4]
    └─ 其他 ▶ [处理5]

[处理1] 空白页
    ├─ F12打开开发者工具
    ├─ 检查console是否有错误
    │ ├─ 有 ▶ 按照"代码崩溃"分支处理
    │ └─ 没有 ▶ 继续
    │
    └─ 检查Elements标签
      ├─ 有 <div id="root"> 吗？
      ├─ 里面有内容吗？
      └─ 如果没有：
        ├─ public/index.html 文件存在吗？
        ├─ app/root.tsx 导出正确吗？
        └─ routes.ts 配置正确吗？

[处理2] 错误信息
    ├─ 读错误信息内容
    ├─ 记录错误代码或错误ID
    ├─ 去 error-encyclopedia.md 查
    └─ 按照指导修复

[处理3] 数据没显示
    ├─ 数据是否加载？
    │ ├─ 检查Network标签 (F12)
    │ ├─ 看Puter API调用是否成功
    │ └─ 是否有响应数据？
    │
    ├─ 数据是否存储在状态中？
    │ └─ 在浏览器console测试:
    │    usePuterStore.getState()
    │
    └─ 数据是否正确显示？
       ├─ 用 {JSON.stringify(data)} 临时显示
       ├─ 检查数据格式
       └─ 检查渲染逻辑

[处理4] 样式很丑
    ├─ Tailwind CSS类是否应用？
    │ └─ 右键检查元素，看class属性
    │
    ├─ class写对了吗？
    │ └─ Tailwind官方文档对照
    │
    └─ 缓存问题？
       └─ 硬刷新: Ctrl+Shift+R

[处理5] 其他显示问题
    ├─ 按钮无法点击？
    │ ├─ 检查onClick handler
    │ └─ 是否有防护(disabled状态)
    │
    ├─ 输入框不工作？
    │ ├─ 检查 value 和 onChange
    │ └─ 检查 state 更新
    │
    └─ 链接无效？
       ├─ 检查 href 或 to 属性
       └─ 检查路由配置
```

---

## 分支4️⃣：数据无法保存

```
上传成功，但数据找不到了
    ↓
[步骤1] 数据是否上传了？
    ├─ F12 → Network 标签
    ├─ 看 puter.fs.upload 是否完成
    ├─ 看 puter.kv.set 是否完成
    └─ 看是否有错误响应
          ↓
    如果上传失败 ▶ 检查错误信息
        ├─ 网络问题 ▶ 检查连接
        ├─ 权限问题 ▶ 确认已登录
        └─ 数据格式 ▶ 检查JSON
          ↓
    如果上传成功但找不到 ▶ 继续
          ↓
[步骤2] 数据存储位置正确吗？
    ├─ 文件系统中查找
    │ └─ F12 console运行:
    │    const files = await puter.fs.readdir('./')
    │    console.log(files)
    │
    └─ KV存储中查找
       └─ F12 console运行:
          const data = await puter.kv.get('resume:xyz')
          console.log(data)
          ↓
    数据存在？
    ├─ 是 ▶ 数据可能在客户端内存中
    │       └─ 刷新页面后再找
    │
    └─ 否 ▶ 存储失败
           └─ 检查错误信息和网络

[步骤3] 用户是否登录？
    └─ const user = await puter.auth.getUser()
       console.log(user)
       ├─ 有用户信息 ▶ 已登录
       └─ 无信息 ▶ 未登录，需重新登录
```

---

## 分支5️⃣：功能表现异常

```
功能不正常，但没有明显的错误
    ↓
[诊断1] 什么表现异常？
    │
    ├─ 响应太慢 ▶ [性能问题]
    ├─ 间歇性失败 ▶ [间歇性问题]
    ├─ 某条件下失败 ▶ [条件特定]
    └─ 数据不一致 ▶ [数据问题]

[性能问题]
    ├─ 找到最慢的操作
    │ └─ 用浏览器DevTools记录
    │
    ├─ 是否涉及大量数据？
    │ └─ 数据是否太多？
    │    ├─ 是 ▶ 分页或筛选
    │    └─ 否 ▶ 继续
    │
    ├─ 是否涉及网络请求？
    │ └─ Network标签看请求时间
    │    ├─ 几秒钟 ▶ 网络慢或数据太大
    │    └─ 几十秒 ▶ AI处理慢，等待
    │
    └─ 是否涉及复杂计算？
       └─ 用浏览器分析工具找热点

[间歇性问题]
    ├─ 第一次成功，第二次失败？
    │ ├─ 检查缓存
    │ ├─ 检查状态管理
    │ └─ 检查是否重复初始化
    │
    ├─ 有时成功有时失败？
    │ ├─ 网络不稳定？
    │ ├─ 时序问题(race condition)?
    │ └─ 资源不足？
    │
    └─ 修复方法:
       ├─ 添加错误重试逻辑
       └─ 确保异步完成再继续

[条件特定]
    ├─ 某个浏览器才出现？
    │ └─ 兼容性问题
    │    └─ 用现代浏览器 (Chrome/Firefox/Edge)
    │
    ├─ 某个操作系统才出现？
    │ └─ 系统特定问题
    │    └─ 需要针对性调试
    │
    ├─ 某个用户才出现？
    │ └─ 数据问题
    │    └─ 检查那个用户的数据
    │
    └─ 网络问题？
       └─ 添加超时和重试

[数据问题]
    ├─ 保存的和读出的不一样？
    │ ├─ 打印两个数据看区别
    │ └─ 检查序列化/反序列化
    │
    ├─ 数据在A页面是对的，B页面是错的？
    │ └─ 检查状态同步逻辑
    │
    └─ 老数据和新数据混乱？
       └─ 检查是否正确清除旧数据
```

---

## 📋 调试检查清单

### 遇到问题时，逐一检查：

基础检查
- [ ] 是否有错误信息？(查看console)
- [ ] 是否有网络错误？(查看Network标签)
- [ ] 是否有权限问题？(检查登录状态)
- [ ] 是否有缓存问题？(硬刷新)

代码检查
- [ ] 变量是否初始化？
- [ ] 函数参数是否正确？
- [ ] 对象属性是否存在？
- [ ] 异步操作是否完成？

数据检查
- [ ] 输入数据格式是否正确？
- [ ] 输出数据是否如预期？
- [ ] 数据是否正确保存？
- [ ] 数据是否正确加载？

逻辑检查
- [ ] 条件判断是否正确？
- [ ] 循环是否会无限进行？
- [ ] 事件监听器是否注销？
- [ ] Promise是否正确处理？

---

## 🔧 快速修复技巧

### 技巧1: 添加日志(Logging)

```javascript
console.log('检查点1:', data)
console.log('检查点2:', result)
console.error('错误:', error)

// 或者用条件日志
if (debug) {
  console.log('详细信息:', details)
}
```

### 技巧2: 条件渲染调试

```jsx
{/* 暂时显示数据看是否加载了 */}
<pre>{JSON.stringify(data, null, 2)}</pre>

{/* 或者显示状态 */}
{loading && <p>加载中...</p>}
{error && <p>错误: {error.message}</p>}
{!loading && !error && <div>内容</div>}
```

### 技巧3: 浏览器断点调试

```
F12 → Sources → 找到代码文件
点击行号添加断点
刷新页面，执行到断点会暂停
检查变量值
按F10单步执行
```

### 技巧4: 网络模拟

```
F12 → Network → 右上角齿轮 → 限流
选择"Slow 3G"模拟慢网络
这样能发现网络超时问题
```

---

## 🆘 完全卡住时

```
1. 重启电脑(经典大法)
2. 删除 node_modules + package-lock.json，重新 npm install
3. 硬刷新浏览器: Ctrl+Shift+R
4. 清除浏览器缓存: F12 → Application → Clear storage
5. 用隐身窗口打开，看是否还有问题
6. 用另一个浏览器试试
7. 查看最近改了什么，试试回滚
8. 用 git diff 看改动
9. 若都不行，重新clone项目
10. 最后，用AI求助，提供完整的错误日志
```

---

## 🎯 调试最佳实践

1. **隔离问题** - 最小化重现问题的代码
2. **逐步排除** - 按逻辑排除可能性
3. **记录日志** - 输出关键变量的值
4. **阅读错误** - 80%的答案在错误信息里
5. **谷歌搜索** - 搜索完整的错误信息
6. **AI求助** - 提供完整信息和历史尝试
7. **分享给别人** - 有时解释给别人就想到解决方案了！

---

**记住**: 调试是编程中最重要的技能之一。每次调试都在提高你的编程能力！🚀
